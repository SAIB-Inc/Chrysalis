// <auto-generated/>
using System;
using System.Collections.Generic;
using System.Formats.Cbor;
using Chrysalis.Cbor.Types;

namespace Chrysalis.Cbor.Types.Custom;

public partial record CborDefListWithTag
{
    // Serialization implementation
    public static new void Write(CborWriter writer, global::Chrysalis.Cbor.Types.Custom.CborMaybeIndefList<T>.CborDefListWithTag value)
    {
        writer.WriteTag(258);
writer.WriteStartMap(null);
// Write property: Value
writer.WriteTextString("Value");
if (value.Value == null)
{
    writer.WriteNull();
}
else
{
    writer.WriteStartArray(value.Value.Count);
foreach (var item in value.Value)
{
    if (item == null)
{
    writer.WriteNull();
}
else
{
    // If we have raw bytes, use them directly
if (item.Raw.HasValue)
{writer.WriteEncodedValue(item.Raw.Value.Span);
}
else
{
    T.Write(writer, item);
}
}
}
writer.WriteEndArray();
}
writer.WriteEndMap();

    }

    // Deserialization implementation
    public static new global::Chrysalis.Cbor.Types.Custom.CborMaybeIndefList<T>.CborDefListWithTag Read(ReadOnlyMemory<byte> data)
    {
        var originalData = data;
var reader = new CborReader(data.Span);
if (reader.ReadTag() != 258) throw new Exception("Invalid tag");
reader.ReadStartMap();
global::System.Collections.Generic.List<T> Value = default;
while (reader.PeekState() != CborReaderState.EndMap)
{
    string key = reader.ReadTextString();
    switch (key)
    {
        case "Value":
            if (reader.PeekState() == CborReaderState.Null)
{
    reader.ReadNull();
    Value = null;
}
else
{
    Value = new global::System.Collections.Generic.List<T>();
reader.ReadStartArray();
while (reader.PeekState() != CborReaderState.EndArray)
{
    T element = default;
    if (reader.PeekState() == CborReaderState.Null)
{
    reader.ReadNull();
    element = null;
}
else
{
    element = T.Read(reader);
}
    Value.Add(element);
}
reader.ReadEndArray();
}
            break;
        default:
            reader.Skip();
            break;
    }
}
reader.ReadEndMap();
var result = new global::Chrysalis.Cbor.Types.Custom.CborMaybeIndefList<T>.CborDefListWithTag(
    Value: Value
);
result.Raw = originalData;
return result;

    }   
}